#!/usr/bin/env node
'use strict';
const account = require('./../cmd-account');
const ipfs = require('./../cmd-ipfs');
const config = require('./../cmd-config');
const colors = require('colors');
const program = require('commander');
const validator = require('validator');

program
    .version('0.0.1')
    .usage('<command>');

// ACCOUNT CMD
program
    .command('account <subCommand> [arg]')
    .usage('<subCommand> [arg]')
    .description('Ethereum account operations. Sub commands: ls [balance], keys <index or address>')
    .action((subCommand, arg, options) => {
        switch (subCommand) {
            case account.ls.name: {
                account.ls(arg, options);
                break;
            }
            case account.keys.name: {
                account.keys(arg, options);
                break;
            }
            default: {
                console.log(`Command 'account ${subCommand}' not found.`);
            }
        }
    });

// IPFS CMD
program
    .command('ipfs <command> [arg] [arg2]')
    .description(
        'IPFS files operations. Commands: ' +
        'add <path>, cat <hash>, ' +
        'ecTag <hash>, decryptEcTag <hash>, decrypt <hash>, delegate <hash> <pubkey> ' +
        'fwatch <filter>, ecwatch <filter>, ecdwatch <filter>'
    )
    .action((command, arg, arg2) => {

        var nonEmptyObject = function (_arg) {
            return arg ? JSON.parse(_arg) : {};
        };

        switch (command) {
            case ipfs.add.name: {
                ipfs.add(arg);
                break;
            }
            case ipfs.cat.name: {
                ipfs.cat(arg);
                break;
            }
            case ipfs.ecTag.name: {
                ipfs.ecTag(arg);
                break;
            }
            case ipfs.decryptEcTag.name: {
                ipfs.decryptEcTag(arg);
                break;
            }
            case ipfs.decrypt.name: {
                ipfs.decrypt(arg);
                break;
            }
            case ipfs.delegate.name: {
                ipfs.delegate(arg, arg2);
                break;
            }
            case ipfs.fwatch.name: {
                ipfs.fwatch(nonEmptyObject(arg));
                break;
            }
            case ipfs.ecwatch.name: {
                ipfs.ecwatch(nonEmptyObject(arg));
                break;
            }
            case ipfs.ecdwatch.name: {
                ipfs.ecdwatch(nonEmptyObject(arg));
                break;
            }
            case ipfs.pull.name: {
                ipfs.pull(arg);
                break;
            }
            case ipfs.providers.name: {
                ipfs.providers(arg);
                break;
            }
        }

    });

program.command('config [command] [arg]')
    .description('File-force configuration. Command: show')
    .action((command, arg, options) => {
       switch (command) {
           case config.show.name: {
               config.show(arg, options);
               break;
           }
           default: {
               config.show(arg, options);
           }
       }
    });


program.parse(process.argv); // notice that we have to parse in a new statement.


